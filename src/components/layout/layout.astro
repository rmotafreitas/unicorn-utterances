---
import layoutStyles from "./layout.module.scss";
import DarkLightButton from "components/dark-light-button/dark-light-button.astro";
import { Icon } from 'astro-icon';

// const { back } = useHistory();

const rootPath = `/`;

const isBase = Astro.canonicalURL.pathname === rootPath;
const isBlogPost = Astro.canonicalURL.pathname.startsWith(`${rootPath}posts`);
const isCollection = Astro.canonicalURL.pathname.startsWith(`${rootPath}collections`);

---
<div class={layoutStyles.horizCenter}>
    <header class={layoutStyles.header} aria-label={"Toolbar for primary action buttons"}>
        <div class={layoutStyles.headerInsideContainer}>
            {!isBase ? (<>
            <button id="backbtn" class={`${layoutStyles.backBtn} baseBtn`} aria-label="Go back">
                <Icon height="36" width="36" name="back" />
            </button>
            <script is:inline>
                const backBtn = document.querySelector('#backbtn');

                let hasHistory = false;
                window.addEventListener('beforeunload', () => {
                    hasHistory = true;
                })

                backBtn.addEventListener('click', () => {
                    if (!document.referrer) {
                        // This is the first page the user has visited on the site in this session
                        window.location.href = '/';
                        return;
                    }
                    history.back();

                    // User cannot go back, meaning that we're at the first page of the site session             
                    setTimeout(() => {
                        if (!hasHistory){
                            window.location.href = "/";
                        }
                    }, 200);
                })
            </script>
            </>
            ) : (
            <div />
            )}
            <div class={layoutStyles.iconList}>
                <!-- <AnalyticsLink category={"outbound"} href="https://discord.gg/FMcvc6T" className={"baseBtn"}
                    aria-label={"Join the Discord"}> -->
                    <Icon height="36" width="36" name="discord" />
                <!-- </AnalyticsLink> -->
                <DarkLightButton />
            </div>
        </div>
    </header>
    <div class={ isCollection ? "" : !isBlogPost ? "listViewContent" : "postViewContent" }>
        <slot />
    </div>
</div>