---
// TODO: Add click back to `li`
// TODO: Make user-profile-pic clickable again
import cardStyles from "./post-card.module.scss";
import UserProfilePic from "../user-profile-pic/user-profile-pic.astro";
import { ListViewPosts } from "utils/fs/api";
import dayjs from "dayjs";

interface PostCardProps {
  title: string; // The title of the post
  authors: ListViewPosts[number]["authors"]; // Info on the authors of the post
  published: string; // Date the author published the post
  tags: string[]; // List of tags associated with the post
  excerpt: string; // The autogenerated excerpt from the GraphQL call
  slug: string; // The post URL slug (which is also it's unique ID)
  description?: string; // The manually written description of the post in the post frontmatter
  class?: string; // class to pass to the post card element
}

const {
  title,
  authors,
  published,
  tags,
  excerpt,
  description,
  class: className = "",
  slug,
} = Astro.props as PostCardProps;

const publishedStr = dayjs(published).format("MMMM D, YYYY");
---

<li class={`${cardStyles.card} ${className}`} role="listitem">
  <div class={cardStyles.cardContents}>
    <a href={`/posts/${slug}`} class="unlink">
      <h2 class={cardStyles.header}>
        {title}
      </h2>
    </a>
    <p class={cardStyles.authorName}>
      <span>by&nbsp;</span>
      <a class={cardStyles.authorLink} href={`/unicorns/${authors[0].id}`}>
        {authors[0].name}
      </a>
      <!-- To avoid having commas on the first author name, we did this -->
      {authors.slice(1).map((author, i) => {
      return (
      <>
        <span>, </span>
        <a href={`/unicorns/${author.id}`} class={cardStyles.authorLink}>
          {author.name}
        </a>
      </>
      );
      })}
    </p>
    <div class={cardStyles.dateTagSubheader}>
      <p class={cardStyles.date}>{publishedStr}</p>
      {tags.map((tag) => (
      <span class={cardStyles.tag}>
        {tag}
      </span>
      ))}
    </div>
    <p class={cardStyles.excerpt} set:html={description || excerpt} />
  </div>
  <UserProfilePic authors={authors} className={cardStyles.authorImagesContainer} />
</li>